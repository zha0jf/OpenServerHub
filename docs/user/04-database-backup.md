# 数据库备份管理

数据库备份功能是 OpenServerHub 系统中用于保护重要数据的关键功能。该功能允许管理员创建、管理、验证和恢复数据库备份，确保在意外情况下能够快速恢复系统数据。

## 功能概述

数据库备份功能提供了以下核心能力：
- 创建数据库备份
- 查看备份列表及详细信息
- 验证备份文件完整性
- 下载备份文件
- 恢复数据库备份
- 删除备份文件

## 权限要求

⚠️ **注意**：只有管理员（Admin）角色的用户才能访问和使用数据库备份功能。

## 访问备份管理界面

1. 登录 OpenServerHub 系统（需使用管理员账户）
2. 在左侧导航菜单中点击"数据库备份"选项

## 功能详解

### 创建备份

1. 在备份管理页面，点击"创建备份"按钮
2. 系统将自动创建一个带有时间戳的备份文件
3. 创建完成后，备份列表会自动刷新显示新创建的备份

### 备份列表

备份列表显示以下信息：
- **名称**：备份文件名（格式：backup_YYYYMMDD_HHMMSS.db）
- **大小**：备份文件大小
- **创建时间**：备份创建的时间

### 验证备份完整性

为确保备份文件未损坏，可以验证备份完整性：
1. 在备份列表中找到目标备份文件
2. 点击"验证完整性"按钮
3. 系统将检查备份文件并显示验证结果

### 下载备份

为防止本地存储故障，建议下载备份文件到其他存储介质：
1. 在备份列表中找到目标备份文件
2. 点击"下载"按钮
3. 浏览器将自动下载备份文件

### 恢复备份

⚠️ **警告**：恢复备份将完全覆盖当前数据库中的所有数据，此操作不可逆！

1. 在备份列表中找到要恢复的备份文件
2. 点击"恢复"按钮
3. 在确认对话框中仔细阅读警告信息
4. 点击"确认恢复"按钮开始恢复过程
5. 恢复完成后，建议刷新页面以确保数据一致性

### 删除备份

为节省存储空间，可以删除不需要的备份文件：
1. 在备份列表中找到要删除的备份文件
2. 点击"删除"按钮
3. 在确认对话框中点击"确认"按钮

## 最佳实践

### 备份策略建议

1. **定期备份**：建议每天创建至少一个备份
2. **多地存储**：将备份文件存储在不同物理位置
3. **版本保留**：保留最近7-30天的备份文件
4. **验证完整性**：定期验证重要备份文件的完整性

### 恢复前准备

1. **创建当前备份**：在恢复之前，建议先创建当前数据库的备份
2. **确认备份文件**：确保要恢复的备份文件是完整且正确的版本
3. **通知相关人员**：恢复操作会影响所有用户，应提前通知相关人员

## 故障排除

### 备份创建失败

可能原因：
- 磁盘空间不足
- 数据库文件被锁定
- 权限不足

解决方案：
- 检查磁盘空间
- 稍后重试
- 联系系统管理员

### 备份验证失败

可能原因：
- 备份文件损坏
- 文件传输过程中出现错误

解决方案：
- 删除损坏的备份文件
- 重新创建备份
- 检查存储介质

### 恢复失败

可能原因：
- 备份文件不兼容
- 系统权限问题

解决方案：
- 确认备份文件版本兼容性
- 联系技术支持

## API 接口

数据库备份功能提供以下 RESTful API 接口：

| 方法 | 路径 | 说明 |
|------|------|------|
| POST | `/api/v1/backup/create` | 创建数据库备份 |
| GET | `/api/v1/backup/list` | 获取备份文件列表 |
| DELETE | `/api/v1/backup/delete` | 删除备份文件 |
| POST | `/api/v1/backup/restore` | 恢复数据库备份 |
| POST | `/api/v1/backup/verify` | 验证备份文件完整性 |
| GET | `/api/v1/backup/download/{filename}` | 下载备份文件 |

所有 API 接口均需要管理员权限认证。

## 技术细节

### 备份机制

系统使用 SQLite 在线备份机制确保数据一致性，备份过程中不会影响系统的正常运行。

### 存储位置

备份文件默认存储在后端服务的 `./backups` 目录中。

### 文件命名

备份文件采用 `backup_YYYYMMDD_HHMMSS.db` 格式命名，其中：
- YYYY: 年份
- MM: 月份
- DD: 日期
- HH: 小时
- MM: 分钟
- SS: 秒