# 监控系统用户指南

## 1. 系统概述

OpenServerHub 监控系统基于业界领先的 Prometheus + Grafana 技术栈构建，提供全面的服务器硬件监控、告警和可视化功能。

## 2. 系统功能

### 2.1 实时监控
- CPU 温度监控
- 风扇转速监控
- 电压监控
- 电源状态监控

### 2.2 告警管理
- 温度异常告警
- 风扇故障告警
- 电压异常告警
- 服务器离线告警

### 2.3 数据可视化
- 实时监控仪表板
- 历史数据查询
- 趋势分析图表
- 多服务器对比视图

## 3. 界面操作指南

### 3.1 访问监控系统

1. 打开浏览器，访问 OpenServerHub 系统
2. 使用管理员账号登录 (默认: admin/admin123)
3. 在左侧导航菜单中点击"监控面板"

### 3.2 监控仪表板使用

#### 3.2.1 选择服务器
1. 在监控面板页面顶部的下拉菜单中选择要监控的服务器
2. 系统将自动加载该服务器的监控数据

#### 3.2.2 查看实时数据
- **数据表格**: 显示各传感器的实时数据，包括温度、电压、风扇转速等
- **图表视图**: 以图表形式展示监控指标的历史趋势

#### 3.2.3 刷新数据
- 点击"刷新数据"按钮手动更新监控数据
- 点击"采集数据"按钮手动触发数据采集

### 3.3 告警状态查看

#### 3.3.1 告警列表
1. 在监控面板页面可以查看当前告警状态
2. 告警按严重程度分为: 正常、警告、严重

#### 3.3.2 告警详情
1. 鼠标悬停在告警项目上可查看详细信息
2. 点击告警项目可查看历史告警记录

### 3.4 历史数据查询

#### 3.4.1 时间范围选择
1. 在监控面板中可以调整时间范围查看历史数据
2. 支持最近1小时、6小时、12小时、24小时等预设时间范围

#### 3.4.2 自定义时间范围
1. 点击时间范围选择器中的"自定义"选项
2. 设置开始时间和结束时间
3. 点击"应用"查看指定时间范围的数据

## 4. 服务器管理与监控

### 4.1 添加服务器监控

#### 4.1.1 添加新服务器
1. 在左侧导航菜单中点击"服务器管理"
2. 点击"添加服务器"按钮
3. 填写服务器信息，包括:
   - 服务器名称
   - IPMI IP地址
   - IPMI用户名和密码
   - 其他可选信息
4. 设置"启用监控"开关为开启状态
5. 点击"提交"完成添加

#### 4.1.2 自动监控配置
- 系统会自动为新添加的服务器配置监控
- 自动在IPMI设备上创建openshub用户用于监控
- 自动创建 Grafana 仪表板

### 4.2 删除服务器监控

#### 4.2.1 删除服务器
1. 在服务器管理页面找到要删除的服务器
2. 点击该服务器行的"删除"按钮
3. 确认删除操作

#### 4.2.2 自动清理配置
- 系统会自动清理该服务器的监控配置
- 从监控目标列表中移除

### 4.3 修改服务器监控配置

#### 4.3.1 编辑服务器信息
1. 在服务器管理页面找到要编辑的服务器
2. 点击该服务器行的"编辑"按钮
3. 修改服务器信息
4. 点击"提交"保存更改

#### 4.3.2 配置同步
- 系统会自动同步修改后的监控配置
- 重新加载监控目标

#### 4.3.3 启用/禁用监控
1. 在服务器管理页面找到目标服务器
2. 点击服务器行的"编辑"按钮
3. 切换"启用监控"开关
4. 点击"提交"保存更改

## 5. 集群监控

### 5.1 分组监控视图

#### 5.1.1 访问集群管理
1. 在左侧导航菜单中点击"集群管理"
2. 系统将显示集群总览信息

#### 5.1.2 查看分组监控
1. 在集群管理页面可以查看各分组的监控状态
2. 显示分组内服务器的在线率、电源状态等统计信息

### 5.2 批量操作与监控

#### 5.2.1 批量电源控制
1. 在服务器管理页面选择多台服务器
2. 点击"批量操作"按钮
3. 选择电源操作类型(开机、关机、重启等)
4. 确认操作，系统将批量执行并更新监控状态

#### 5.2.2 批量启用/禁用监控
1. 在服务器管理页面选择多台服务器
2. 点击"批量操作"按钮
3. 选择"批量启用监控"或"批量禁用监控"
4. 确认操作，系统将批量更新监控状态

## 6. 告警配置

### 6.1 告警规则管理

#### 6.1.1 默认告警规则
系统预置了以下告警规则：
- CPU 温度超过 80°C 持续 2 分钟触发警告
- 风扇转速为 0 持续 30 秒触发严重告警
- 服务器离线持续 5 分钟触发严重告警
- 电压偏离标准值 0.3V 持续 1 分钟触发警告

#### 6.1.2 自定义告警规则
(需要管理员权限，通过配置文件修改)

### 6.2 告警通知配置

#### 6.2.1 邮件通知
系统支持通过邮件发送告警通知，需要配置:
- SMTP 服务器地址
- 发件人邮箱
- 收件人邮箱

#### 6.2.2 Webhook 通知
系统支持通过 Webhook 发送告警到其他系统。

## 7. 性能优化建议

### 7.1 数据查询优化
- 合理选择时间范围，避免查询过大的数据集
- 使用预设时间范围提高查询效率

### 7.2 界面性能
- 避免同时打开过多监控面板
- 定期刷新页面释放内存

## 8. 故障排除

### 8.1 监控数据缺失
1. 检查服务器 IPMI 连接是否正常
2. 检查 IPMI Exporter 是否正常运行
3. 检查网络连接是否正常
4. 检查服务器是否启用了监控功能

### 8.2 告警未触发
1. 检查告警规则设置是否正确
2. 检查监控数据是否符合告警条件
3. 检查告警通知配置是否正确

### 8.3 界面显示异常
1. 刷新页面或清除浏览器缓存
2. 检查网络连接是否正常
3. 检查 Grafana 服务是否正常运行

## 9. 最佳实践

### 9.1 监控策略
- 根据服务器重要性设置不同的监控频率
- 为关键指标设置更敏感的告警阈值
- 定期审查和优化告警规则

### 9.2 告警管理
- 避免告警风暴，合理设置告警分组
- 定期审查告警历史，优化告警策略
- 建立告警响应流程

### 9.3 数据管理
- 定期备份监控数据
- 建立数据清理策略
- 监控系统资源使用情况

## 10. 常见问题解答

### 10.1 为什么看不到监控数据？
可能原因：
1. 服务器未启用监控功能
2. 服务器 IPMI 配置错误
3. IPMI Exporter 未正确启动
4. 网络连接问题
5. Prometheus 配置错误

### 10.2 如何添加新的监控服务器？
1. 在服务器管理页面添加服务器
2. 确保启用了监控功能
3. 系统会自动配置监控组件
4. 等待数据开始收集（通常需要几分钟）

### 10.3 如何修改告警阈值？
1. 联系系统管理员
2. 通过配置文件修改告警规则
3. 重新加载配置或重启服务

### 10.4 如何查看历史监控数据？
1. 通过监控面板的时间范围选择器查看历史数据
2. 通过 Grafana 界面进行更详细的查询
3. 通过 Prometheus API 查询原始数据
